<!DOCTYPE html>
<html lang="en">

<head>
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

</head>

<body>
  <ul class="navbar">
      <li><a class="active" href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('booking') }}">Book Room</a></li>
      <li><a href="{{ url_for('contact') }}">Contact</a></li>
      <li><a href="{{ url_for('information') }}">Information</a></li>
  </ul>
  <h1>Home</h1>
  
  <!-- CAN MAYBE BE USED FOR CONTENT ON HOME PAGE
  <button class="accordion" id="4118">Room 4.118</button>
  <div class="panel">
      <p>
          <table style="width:65%">
          <tr>
            <th>Name</th>
            <th>Telephone</th>
            <th>Telephone</th>
          </tr>
          <tr>
            <td>Bill Gates</td>
            <td>555 77 854</td>
            <td>555 77 855</td>
          </tr>
        </table>
        Current Status: Available--> <!-- TODO: Her skal vi implementere en availability status funktion -->
        <!-- <br> Next Booking: Tue 10:00 --><!-- TODO: Her skal vi implementere en 'next booking' funktion-->
        <!--<br> 
      </p>
  </div>
  -->

  {% for room in room_info %}
  <button class="accordion" data-room={{ room.room }}> <!--data-room is added from chat gpt-->
    {{ room.room }}
    <span id="StatusIndicator{{ room.room }}" class="accordion-status-indicator"
    style="background-color: {{'green' if room.status else 'red'}}"></span>
    <p id="Textindicator"> Status: {{ "Available" if room.status else "Reserved" }} </p>
  </button>
    <div class="panel">
        <!--Calendar function here-->
      <!--define a unique calendar for each group room-->
     <!-- Unique ID for each calendar container -->
    <div id="calendarContainer{{ room.room }}">
      <h2>Weekly Calendar</h2>
      <!-- Use a consistent class name for the calendar container -->
      <div class="days-container" id="daysContainer{{ room.room }}">
      
      </div>
    </div>
      <p><br>Status: {{ "Available" if room.status else "Reserved" }}
      <br> Next Booking: </p>
    </div>
   
{% endfor %}
  
  <div class="container">
    <input type="checkbox" name="" id="zoom_img" />
    <label for="zoom_img">
      <img src="{{ url_for('static', filename='images/K3map.png') }}" alt="Map">
    </label>
  </div>
   
  <script> 
   

  // Dette er JS for at accordion fungerer
  document.addEventListener('DOMContentLoaded', function() {
    var accordions = document.querySelectorAll('.accordion');

    // Add click event listeners to each accordion
    accordions.forEach(function(accordion) {
        accordion.addEventListener('click', function() {
            // Check if the clicked accordion is already active
            var isActive = this.classList.contains('active');

            // Close all accordions
            accordions.forEach(function(otherAccordion) {
                otherAccordion.classList.remove('active');
                otherAccordion.nextElementSibling.style.display = 'none';
            });

            // Toggle the active class and show/hide the panel
            this.classList.toggle('active', !isActive);
            var panel = this.nextElementSibling;
            panel.style.display = isActive ? 'none' : 'block';
        });
    });
});

function generateWeeklyCalendar(roomNumber, availabilityStatus) {
  const container = document.getElementById(`daysContainer${roomNumber}`);

  // Get the days of the week (Monday through Friday)
  const daysOfWeek = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];

  // Display only the days for the current week
  const currentDate = new Date();
  const currentDayOfWeek = currentDate.getDay(); // 0 for Sunday, 1 for Monday, etc.

  // Clear previous content in the container
  container.innerHTML = '';

  // Display the days in the HTML
  daysOfWeek.forEach((day) => {
    const dayElement = document.createElement('div');
    dayElement.className = 'day';
    dayElement.textContent = day;

    // Set background color based on availability status
   dayElement.style.backgroundColor = getBackgroundColor(availabilityStatus);

    container.appendChild(dayElement);
  });
}

// Function to determine background color based on availability status
function getBackgroundColor(day, availabilityStatus){
  if (availabilityStatus === 'booked') {
    // Check if all timeslots for the day are booked
    if (allTimeslotsBookedForDay(day)) {
      return '#F16B5C'; // Red for fully booked
    } else {
      return '#FFD700'; // Yellow for partially booked
    }
  } else {
    return '#B3D93A'; // Green for available
  }
}  


/*function getBackgroundColor(availabilityStatus) {
  if (availabilityStatus === 'booked') {
    return '#F16B5C'; // Red for fully booked
  } else if (allTimesSlotBookedForDay === 'partial') {
    return '#FFD700'; // Yellow for partially booked
  } else {
    return '#B3D93A'; // Green for available
  }
}*/ //old code assuming the new doesn't work

// Generate calendars for each room
{% for room in room_info|sort(attribute='status', reverse=True) %}
  generateWeeklyCalendar('{{ room.room }}', '{{ room.availability }}');
{% endfor %}

// Highlight the current day in each calendar
const currentDate = new Date();
const currentDayOfWeek = currentDate.getDay();
// const currentDay = currentDate.toLocaleDateString('en-US', { weekday: 'short' });

document.querySelectorAll('.days-container').forEach(container => {
const days = container.querySelectorAll('.day');
days.forEach((day, index) => {
  const dayIndex = (currentDayOfWeek + index) % 7;
  if (dayIndex === currentDayOfWeek) {
    day.classList.add('current-day');
  }
});
});

</script> 

<script src = "{{ url_for('static', filename='js/BookingJavascript.js') }}"></script>
</body>

</html>